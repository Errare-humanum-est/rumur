language: cpp

branches:
  only:
    - master

matrix:
  include:

  - name: Ubuntu Linux 20.04, GCC multilib (executable, murphi2c, murphi2xml)
    os: linux
    dist: focal
    addons:
      apt:
        packages:
          - g++-multilib
          - libc6-dev-i386
          - libfl-dev
          - libxml2-utils
          - valgrind
    env:
      - TEST_ARGS="executable murphi2c murphi2cHeader murphi2xml"
      - MATRIX_EVAL="CC=gcc && CXX=g++"
      - CXXFLAGS="-pedantic -Werror -g -fno-omit-frame-pointer -fsanitize=undefined -fno-sanitize-recover=undefined -fuse-ld=gold"
      - UBSAN_OPTIONS=print_stacktrace=1

  - name: Ubuntu Linux 20.04, GCC multilib (rumur single-threaded)
    os: linux
    dist: focal
    addons:
      apt:
        packages:
          - g++-multilib
          - libc6-dev-i386
          - libfl-dev
          - libxml2-utils
          - valgrind
    env:
      - TEST_ARGS="rumurDebugSingleThreaded rumurSingleThreaded"
      - MATRIX_EVAL="CC=gcc && CXX=g++"
      - CXXFLAGS="-pedantic -Werror -g -fno-omit-frame-pointer -fsanitize=undefined -fno-sanitize-recover=undefined -fuse-ld=gold"
      - UBSAN_OPTIONS=print_stacktrace=1

  - name: Ubuntu Linux 20.04, GCC multilib (rumur optimised single-threaded)
    os: linux
    dist: focal
    addons:
      apt:
        packages:
          - g++-multilib
          - libc6-dev-i386
          - libfl-dev
          - libxml2-utils
          - valgrind
    env:
      - TEST_ARGS="rumurDebugOptimisedSingleThreaded rumurOptimisedSingleThreaded"
      - MATRIX_EVAL="CC=gcc && CXX=g++"
      - CXXFLAGS="-pedantic -Werror -g -fno-omit-frame-pointer -fsanitize=undefined -fno-sanitize-recover=undefined -fuse-ld=gold"
      - UBSAN_OPTIONS=print_stacktrace=1

  - name: Ubuntu Linux 20.04, GCC multilib (rumur multithreaded)
    os: linux
    dist: focal
    addons:
      apt:
        packages:
          - g++-multilib
          - libc6-dev-i386
          - libfl-dev
          - libxml2-utils
          - valgrind
    env:
      - TEST_ARGS="rumurDebugMultithreaded rumurMultithreaded"
      - MATRIX_EVAL="CC=gcc && CXX=g++"
      - CXXFLAGS="-pedantic -Werror -g -fno-omit-frame-pointer -fsanitize=undefined -fno-sanitize-recover=undefined -fuse-ld=gold"
      - UBSAN_OPTIONS=print_stacktrace=1

  - name: Ubuntu Linux 20.04, GCC multilib (rumur optimised multithreaded)
    os: linux
    dist: focal
    addons:
      apt:
        packages:
          - g++-multilib
          - libc6-dev-i386
          - libfl-dev
          - libxml2-utils
          - valgrind
    env:
      - TEST_ARGS="rumurDebugOptimisedMultithreaded rumurOptimisedMultithreaded"
      - MATRIX_EVAL="CC=gcc && CXX=g++"
      - CXXFLAGS="-pedantic -Werror -g -fno-omit-frame-pointer -fsanitize=undefined -fno-sanitize-recover=undefined -fuse-ld=gold"
      - UBSAN_OPTIONS=print_stacktrace=1

  - name: Ubuntu Linux 20.04, GCC multilib (rumur single-threaded XML)
    os: linux
    dist: focal
    addons:
      apt:
        packages:
          - g++-multilib
          - libc6-dev-i386
          - libfl-dev
          - libxml2-utils
          - valgrind
    env:
      - TEST_ARGS="rumurOptimisedSingleThreadedXML rumurSingleThreadedXML"
      - MATRIX_EVAL="CC=gcc && CXX=g++"
      - CXXFLAGS="-pedantic -Werror -g -fno-omit-frame-pointer -fsanitize=undefined -fno-sanitize-recover=undefined -fuse-ld=gold"
      - UBSAN_OPTIONS=print_stacktrace=1

  - name: Ubuntu Linux 20.04, GCC multilib (rumur multithreaded XML)
    os: linux
    dist: focal
    addons:
      apt:
        packages:
          - g++-multilib
          - libc6-dev-i386
          - libfl-dev
          - libxml2-utils
          - valgrind
    env:
      - TEST_ARGS="rumurOptimisedMultithreadedXML rumurMultithreadedXML"
      - MATRIX_EVAL="CC=gcc && CXX=g++"
      - CXXFLAGS="-pedantic -Werror -g -fno-omit-frame-pointer -fsanitize=undefined -fno-sanitize-recover=undefined -fuse-ld=gold"
      - UBSAN_OPTIONS=print_stacktrace=1

  - name: Ubuntu Linux 14.04, Clang 3.8 (executable, murphi2c, murphi2xml)
    os: linux
    dist: trusty
    addons:
      apt:
        sources:
          - deadsnakes
          - ubuntu-toolchain-r-test
          - llvm-toolchain-precise-3.8
        packages:
          - clang-3.8
          - g++-6
          - libxml2-utils
          - python3.6
          - valgrind
    env:
      - TEST_ARGS="executable murphi2c murphi2cHeader murphi2xml"
      - MATRIX_EVAL="sudo ln -sf /usr/bin/python3.6 /usr/bin/python3 && CC=clang-3.8 && CXX=clang++-3.8"
      - CXXFLAGS="-pedantic -Werror -g -fno-omit-frame-pointer -fsanitize=undefined -fno-sanitize-recover=undefined"
      - UBSAN_OPTIONS=print_stacktrace=1

  - name: Ubuntu Linux 14.04, Clang 3.8 (rumur single-threaded)
    os: linux
    dist: trusty
    addons:
      apt:
        sources:
          - deadsnakes
          - ubuntu-toolchain-r-test
          - llvm-toolchain-precise-3.8
        packages:
          - clang-3.8
          - g++-6
          - libxml2-utils
          - python3.6
          - valgrind
    env:
      - TEST_ARGS="rumurDebugSingleThreaded rumurSingleThreaded"
      - MATRIX_EVAL="sudo ln -sf /usr/bin/python3.6 /usr/bin/python3 && CC=clang-3.8 && CXX=clang++-3.8"
      - CXXFLAGS="-pedantic -Werror -g -fno-omit-frame-pointer -fsanitize=undefined -fno-sanitize-recover=undefined"
      - UBSAN_OPTIONS=print_stacktrace=1

  - name: Ubuntu Linux 14.04, Clang 3.8 (rumur optimised single-threaded)
    os: linux
    dist: trusty
    addons:
      apt:
        sources:
          - deadsnakes
          - ubuntu-toolchain-r-test
          - llvm-toolchain-precise-3.8
        packages:
          - clang-3.8
          - g++-6
          - libxml2-utils
          - python3.6
          - valgrind
    env:
      - TEST_ARGS="rumurDebugOptimisedSingleThreaded rumurOptimisedSingleThreaded"
      - MATRIX_EVAL="sudo ln -sf /usr/bin/python3.6 /usr/bin/python3 && CC=clang-3.8 && CXX=clang++-3.8"
      - CXXFLAGS="-pedantic -Werror -g -fno-omit-frame-pointer -fsanitize=undefined -fno-sanitize-recover=undefined"
      - UBSAN_OPTIONS=print_stacktrace=1

  - name: Ubuntu Linux 14.04, Clang 3.8 (rumur multithreaded)
    os: linux
    dist: trusty
    addons:
      apt:
        sources:
          - deadsnakes
          - ubuntu-toolchain-r-test
          - llvm-toolchain-precise-3.8
        packages:
          - clang-3.8
          - g++-6
          - libxml2-utils
          - python3.6
          - valgrind
    env:
      - TEST_ARGS="rumurDebugMultithreaded rumurMultithreaded"
      - MATRIX_EVAL="sudo ln -sf /usr/bin/python3.6 /usr/bin/python3 && CC=clang-3.8 && CXX=clang++-3.8"
      - CXXFLAGS="-pedantic -Werror -g -fno-omit-frame-pointer -fsanitize=undefined -fno-sanitize-recover=undefined"
      - UBSAN_OPTIONS=print_stacktrace=1

  - name: Ubuntu Linux 14.04, Clang 3.8 (rumur optimised multithreaded)
    os: linux
    dist: trusty
    addons:
      apt:
        sources:
          - deadsnakes
          - ubuntu-toolchain-r-test
          - llvm-toolchain-precise-3.8
        packages:
          - clang-3.8
          - g++-6
          - libxml2-utils
          - python3.6
          - valgrind
    env:
      - TEST_ARGS="rumurDebugOptimisedMultithreaded rumurOptimisedMultithreaded"
      - MATRIX_EVAL="sudo ln -sf /usr/bin/python3.6 /usr/bin/python3 && CC=clang-3.8 && CXX=clang++-3.8"
      - CXXFLAGS="-pedantic -Werror -g -fno-omit-frame-pointer -fsanitize=undefined -fno-sanitize-recover=undefined"
      - UBSAN_OPTIONS=print_stacktrace=1

  - name: Ubuntu Linux 14.04, Clang 3.8 (rumur single-threaded XML)
    os: linux
    dist: trusty
    addons:
      apt:
        sources:
          - deadsnakes
          - ubuntu-toolchain-r-test
          - llvm-toolchain-precise-3.8
        packages:
          - clang-3.8
          - g++-6
          - libxml2-utils
          - python3.6
          - valgrind
    env:
      - TEST_ARGS="rumurOptimisedSingleThreadedXML rumurSingleThreadedXML"
      - MATRIX_EVAL="sudo ln -sf /usr/bin/python3.6 /usr/bin/python3 && CC=clang-3.8 && CXX=clang++-3.8"
      - CXXFLAGS="-pedantic -Werror -g -fno-omit-frame-pointer -fsanitize=undefined -fno-sanitize-recover=undefined"
      - UBSAN_OPTIONS=print_stacktrace=1

  - name: Ubuntu Linux 14.04, Clang 3.8 (rumur multithreaded XML)
    os: linux
    dist: trusty
    addons:
      apt:
        sources:
          - deadsnakes
          - ubuntu-toolchain-r-test
          - llvm-toolchain-precise-3.8
        packages:
          - clang-3.8
          - g++-6
          - libxml2-utils
          - python3.6
          - valgrind
    env:
      - TEST_ARGS="rumurOptimisedMultithreadedXML rumurMultithreadedXML"
      - MATRIX_EVAL="sudo ln -sf /usr/bin/python3.6 /usr/bin/python3 && CC=clang-3.8 && CXX=clang++-3.8"
      - CXXFLAGS="-pedantic -Werror -g -fno-omit-frame-pointer -fsanitize=undefined -fno-sanitize-recover=undefined"
      - UBSAN_OPTIONS=print_stacktrace=1

  - name: Ubuntu Linux 14.04, Clang 3.9 (executable, murphi2c, murphi2xml)
    os: linux
    dist: trusty
    addons:
      apt:
        sources:
          - deadsnakes
          - ubuntu-toolchain-r-test
          - llvm-toolchain-trusty-3.9
        packages:
          - clang-3.9
          - g++-6
          - libxml2-utils
          - python3.6
          - valgrind
    env:
      - TEST_ARGS="executable murphi2c murphi2cHeader murphi2xml"
      - MATRIX_EVAL="sudo ln -sf /usr/bin/python3.6 /usr/bin/python3 && CC=clang-3.9 && CXX=clang++-3.9"
      # We don't enable any sanitizers for this build because the Clang and LLVM
      # packages seem conflicting in Travis' Ubuntu image. More information:
      # https://github.com/travis-ci/travis-ci/issues/8026.
      - CXXFLAGS="-pedantic -Werror"

  - name: Ubuntu Linux 14.04, Clang 3.9 (rumur single-threaded)
    os: linux
    dist: trusty
    addons:
      apt:
        sources:
          - deadsnakes
          - ubuntu-toolchain-r-test
          - llvm-toolchain-trusty-3.9
        packages:
          - clang-3.9
          - g++-6
          - libxml2-utils
          - python3.6
          - valgrind
    env:
      - TEST_ARGS="rumurDebugSingleThreaded rumurSingleThreaded"
      - MATRIX_EVAL="sudo ln -sf /usr/bin/python3.6 /usr/bin/python3 && CC=clang-3.9 && CXX=clang++-3.9"
      - CXXFLAGS="-pedantic -Werror"

  - name: Ubuntu Linux 14.04, Clang 3.9 (rumur optimised single-threaded)
    os: linux
    dist: trusty
    addons:
      apt:
        sources:
          - deadsnakes
          - ubuntu-toolchain-r-test
          - llvm-toolchain-trusty-3.9
        packages:
          - clang-3.9
          - g++-6
          - libxml2-utils
          - python3.6
          - valgrind
    env:
      - TEST_ARGS="rumurDebugOptimisedSingleThreaded rumurOptimisedSingleThreaded"
      - MATRIX_EVAL="sudo ln -sf /usr/bin/python3.6 /usr/bin/python3 && CC=clang-3.9 && CXX=clang++-3.9"
      - CXXFLAGS="-pedantic -Werror"

  - name: Ubuntu Linux 14.04, Clang 3.9 (rumur multithreaded)
    os: linux
    dist: trusty
    addons:
      apt:
        sources:
          - deadsnakes
          - ubuntu-toolchain-r-test
          - llvm-toolchain-trusty-3.9
        packages:
          - clang-3.9
          - g++-6
          - libxml2-utils
          - python3.6
          - valgrind
    env:
      - TEST_ARGS="rumurDebugMultithreaded rumurMultithreaded"
      - MATRIX_EVAL="sudo ln -sf /usr/bin/python3.6 /usr/bin/python3 && CC=clang-3.9 && CXX=clang++-3.9"
      - CXXFLAGS="-pedantic -Werror"

  - name: Ubuntu Linux 14.04, Clang 3.9 (rumur optimised multithreaded)
    os: linux
    dist: trusty
    addons:
      apt:
        sources:
          - deadsnakes
          - ubuntu-toolchain-r-test
          - llvm-toolchain-trusty-3.9
        packages:
          - clang-3.9
          - g++-6
          - libxml2-utils
          - python3.6
          - valgrind
    env:
      - TEST_ARGS="rumurDebugOptimisedMultithreaded rumurOptimisedMultithreaded"
      - MATRIX_EVAL="sudo ln -sf /usr/bin/python3.6 /usr/bin/python3 && CC=clang-3.9 && CXX=clang++-3.9"
      - CXXFLAGS="-pedantic -Werror"

  - name: Ubuntu Linux 14.04, Clang 3.9 (rumur single-threaded XML)
    os: linux
    dist: trusty
    addons:
      apt:
        sources:
          - deadsnakes
          - ubuntu-toolchain-r-test
          - llvm-toolchain-trusty-3.9
        packages:
          - clang-3.9
          - g++-6
          - libxml2-utils
          - python3.6
          - valgrind
    env:
      - TEST_ARGS="rumurOptimisedSingleThreadedXML rumurSingleThreadedXML"
      - MATRIX_EVAL="sudo ln -sf /usr/bin/python3.6 /usr/bin/python3 && CC=clang-3.9 && CXX=clang++-3.9"
      - CXXFLAGS="-pedantic -Werror"

  - name: Ubuntu Linux 14.04, Clang 3.9 (rumur multithreaded XML)
    os: linux
    dist: trusty
    addons:
      apt:
        sources:
          - deadsnakes
          - ubuntu-toolchain-r-test
          - llvm-toolchain-trusty-3.9
        packages:
          - clang-3.9
          - g++-6
          - libxml2-utils
          - python3.6
          - valgrind
    env:
      - TEST_ARGS="rumurOptimisedMultithreadedXML rumurMultithreadedXML"
      - MATRIX_EVAL="sudo ln -sf /usr/bin/python3.6 /usr/bin/python3 && CC=clang-3.9 && CXX=clang++-3.9"
      - CXXFLAGS="-pedantic -Werror"

  - name: Ubuntu Linux 14.04, Clang 4.0 (executable, murphi2c, murphi2xml)
    os: linux
    dist: trusty
    addons:
      apt:
        sources:
          - deadsnakes
          - ubuntu-toolchain-r-test
          - llvm-toolchain-trusty-4.0
        packages:
          - clang-4.0
          - g++-6
          - libxml2-utils
          - python3.6
          - valgrind
    env:
      - TEST_ARGS="executable murphi2c murphi2cHeader murphi2xml"
      - MATRIX_EVAL="sudo ln -sf /usr/bin/python3.6 /usr/bin/python3 && CC=clang-4.0 && CXX=clang++-4.0"
      - CXXFLAGS="-pedantic -Werror -g -fno-omit-frame-pointer -fsanitize=undefined -fno-sanitize-recover=undefined"
      - UBSAN_OPTIONS=print_stacktrace=1

  - name: Ubuntu Linux 14.04, Clang 4.0 (rumur single-threaded)
    os: linux
    dist: trusty
    addons:
      apt:
        sources:
          - deadsnakes
          - ubuntu-toolchain-r-test
          - llvm-toolchain-trusty-4.0
        packages:
          - clang-4.0
          - g++-6
          - libxml2-utils
          - python3.6
          - valgrind
    env:
      - TEST_ARGS="rumurDebugSingleThreaded rumurSingleThreaded"
      - MATRIX_EVAL="sudo ln -sf /usr/bin/python3.6 /usr/bin/python3 && CC=clang-4.0 && CXX=clang++-4.0"
      - CXXFLAGS="-pedantic -Werror -g -fno-omit-frame-pointer -fsanitize=undefined -fno-sanitize-recover=undefined"
      - UBSAN_OPTIONS=print_stacktrace=1

  - name: Ubuntu Linux 14.04, Clang 4.0 (rumur optimised single-threaded)
    os: linux
    dist: trusty
    addons:
      apt:
        sources:
          - deadsnakes
          - ubuntu-toolchain-r-test
          - llvm-toolchain-trusty-4.0
        packages:
          - clang-4.0
          - g++-6
          - libxml2-utils
          - python3.6
          - valgrind
    env:
      - TEST_ARGS="rumurDebugOptimisedSingleThreaded rumurOptimisedSingleThreaded"
      - MATRIX_EVAL="sudo ln -sf /usr/bin/python3.6 /usr/bin/python3 && CC=clang-4.0 && CXX=clang++-4.0"
      - CXXFLAGS="-pedantic -Werror -g -fno-omit-frame-pointer -fsanitize=undefined -fno-sanitize-recover=undefined"
      - UBSAN_OPTIONS=print_stacktrace=1

  - name: Ubuntu Linux 14.04, Clang 4.0 (rumur multithreaded)
    os: linux
    dist: trusty
    addons:
      apt:
        sources:
          - deadsnakes
          - ubuntu-toolchain-r-test
          - llvm-toolchain-trusty-4.0
        packages:
          - clang-4.0
          - g++-6
          - libxml2-utils
          - python3.6
          - valgrind
    env:
      - TEST_ARGS="rumurDebugMultithreaded rumurMultithreaded"
      - MATRIX_EVAL="sudo ln -sf /usr/bin/python3.6 /usr/bin/python3 && CC=clang-4.0 && CXX=clang++-4.0"
      - CXXFLAGS="-pedantic -Werror -g -fno-omit-frame-pointer -fsanitize=undefined -fno-sanitize-recover=undefined"
      - UBSAN_OPTIONS=print_stacktrace=1

  - name: Ubuntu Linux 14.04, Clang 4.0 (rumur optimised multithreaded)
    os: linux
    dist: trusty
    addons:
      apt:
        sources:
          - deadsnakes
          - ubuntu-toolchain-r-test
          - llvm-toolchain-trusty-4.0
        packages:
          - clang-4.0
          - g++-6
          - libxml2-utils
          - python3.6
          - valgrind
    env:
      - TEST_ARGS="rumurDebugOptimisedMultithreaded rumurOptimisedMultithreaded"
      - MATRIX_EVAL="sudo ln -sf /usr/bin/python3.6 /usr/bin/python3 && CC=clang-4.0 && CXX=clang++-4.0"
      - CXXFLAGS="-pedantic -Werror -g -fno-omit-frame-pointer -fsanitize=undefined -fno-sanitize-recover=undefined"
      - UBSAN_OPTIONS=print_stacktrace=1

  - name: Ubuntu Linux 14.04, Clang 4.0 (rumur single-threaded XML)
    os: linux
    dist: trusty
    addons:
      apt:
        sources:
          - deadsnakes
          - ubuntu-toolchain-r-test
          - llvm-toolchain-trusty-4.0
        packages:
          - clang-4.0
          - g++-6
          - libxml2-utils
          - python3.6
          - valgrind
    env:
      - TEST_ARGS="rumurOptimisedSingleThreadedXML rumurSingleThreadedXML"
      - MATRIX_EVAL="sudo ln -sf /usr/bin/python3.6 /usr/bin/python3 && CC=clang-4.0 && CXX=clang++-4.0"
      - CXXFLAGS="-pedantic -Werror -g -fno-omit-frame-pointer -fsanitize=undefined -fno-sanitize-recover=undefined"
      - UBSAN_OPTIONS=print_stacktrace=1

  - name: Ubuntu Linux 14.04, Clang 4.0 (rumur multithreaded XML)
    os: linux
    dist: trusty
    addons:
      apt:
        sources:
          - deadsnakes
          - ubuntu-toolchain-r-test
          - llvm-toolchain-trusty-4.0
        packages:
          - clang-4.0
          - g++-6
          - libxml2-utils
          - python3.6
          - valgrind
    env:
      - TEST_ARGS="rumurOptimisedMultithreadedXML rumurMultithreadedXML"
      - MATRIX_EVAL="sudo ln -sf /usr/bin/python3.6 /usr/bin/python3 && CC=clang-4.0 && CXX=clang++-4.0"
      - CXXFLAGS="-pedantic -Werror -g -fno-omit-frame-pointer -fsanitize=undefined -fno-sanitize-recover=undefined"
      - UBSAN_OPTIONS=print_stacktrace=1

  - name: Ubuntu Linux 14.04, Clang 5.0 (executable, murphi2c, murphi2xml)
    os: linux
    dist: trusty
    addons:
      apt:
        sources:
          - deadsnakes
          - ubuntu-toolchain-r-test
          - llvm-toolchain-trusty-5.0
        packages:
          - clang-5.0
          - g++-6
          - libxml2-utils
          - python3.6
          - valgrind
    env:
      - TEST_ARGS="executable murphi2c murphi2cHeader murphi2xml"
      - MATRIX_EVAL="sudo ln -sf /usr/bin/python3.6 /usr/bin/python3 && CC=clang-5.0 && CXX=clang++-5.0"
      - CXXFLAGS="-pedantic -Werror -g -fno-omit-frame-pointer -fsanitize=undefined -fno-sanitize-recover=undefined"
      - UBSAN_OPTIONS=print_stacktrace=1

  - name: Ubuntu Linux 14.04, Clang 5.0 (rumur single-threaded)
    os: linux
    dist: trusty
    addons:
      apt:
        sources:
          - deadsnakes
          - ubuntu-toolchain-r-test
          - llvm-toolchain-trusty-5.0
        packages:
          - clang-5.0
          - g++-6
          - libxml2-utils
          - python3.6
          - valgrind
    env:
      - TEST_ARGS="rumurDebugSingleThreaded rumurSingleThreaded"
      - MATRIX_EVAL="sudo ln -sf /usr/bin/python3.6 /usr/bin/python3 && CC=clang-5.0 && CXX=clang++-5.0"
      - CXXFLAGS="-pedantic -Werror -g -fno-omit-frame-pointer -fsanitize=undefined -fno-sanitize-recover=undefined"
      - UBSAN_OPTIONS=print_stacktrace=1

  - name: Ubuntu Linux 14.04, Clang 5.0 (rumur optimised single-threaded)
    os: linux
    dist: trusty
    addons:
      apt:
        sources:
          - deadsnakes
          - ubuntu-toolchain-r-test
          - llvm-toolchain-trusty-5.0
        packages:
          - clang-5.0
          - g++-6
          - libxml2-utils
          - python3.6
          - valgrind
    env:
      - TEST_ARGS="rumurDebugOptimisedSingleThreaded rumurOptimisedSingleThreaded"
      - MATRIX_EVAL="sudo ln -sf /usr/bin/python3.6 /usr/bin/python3 && CC=clang-5.0 && CXX=clang++-5.0"
      - CXXFLAGS="-pedantic -Werror -g -fno-omit-frame-pointer -fsanitize=undefined -fno-sanitize-recover=undefined"
      - UBSAN_OPTIONS=print_stacktrace=1

  - name: Ubuntu Linux 14.04, Clang 5.0 (rumur multithreaded)
    os: linux
    dist: trusty
    addons:
      apt:
        sources:
          - deadsnakes
          - ubuntu-toolchain-r-test
          - llvm-toolchain-trusty-5.0
        packages:
          - clang-5.0
          - g++-6
          - libxml2-utils
          - python3.6
          - valgrind
    env:
      - TEST_ARGS="rumurDebugMultithreaded rumurMultithreaded"
      - MATRIX_EVAL="sudo ln -sf /usr/bin/python3.6 /usr/bin/python3 && CC=clang-5.0 && CXX=clang++-5.0"
      - CXXFLAGS="-pedantic -Werror -g -fno-omit-frame-pointer -fsanitize=undefined -fno-sanitize-recover=undefined"
      - UBSAN_OPTIONS=print_stacktrace=1

  - name: Ubuntu Linux 14.04, Clang 5.0 (rumur optimised multithreaded)
    os: linux
    dist: trusty
    addons:
      apt:
        sources:
          - deadsnakes
          - ubuntu-toolchain-r-test
          - llvm-toolchain-trusty-5.0
        packages:
          - clang-5.0
          - g++-6
          - libxml2-utils
          - python3.6
          - valgrind
    env:
      - TEST_ARGS="rumurDebugOptimisedMultithreaded rumurOptimisedMultithreaded"
      - MATRIX_EVAL="sudo ln -sf /usr/bin/python3.6 /usr/bin/python3 && CC=clang-5.0 && CXX=clang++-5.0"
      - CXXFLAGS="-pedantic -Werror -g -fno-omit-frame-pointer -fsanitize=undefined -fno-sanitize-recover=undefined"
      - UBSAN_OPTIONS=print_stacktrace=1

  - name: Ubuntu Linux 14.04, Clang 5.0 (rumur single-threaded XML)
    os: linux
    dist: trusty
    addons:
      apt:
        sources:
          - deadsnakes
          - ubuntu-toolchain-r-test
          - llvm-toolchain-trusty-5.0
        packages:
          - clang-5.0
          - g++-6
          - libxml2-utils
          - python3.6
          - valgrind
    env:
      - TEST_ARGS="rumurOptimisedSingleThreadedXML rumurSingleThreadedXML"
      - MATRIX_EVAL="sudo ln -sf /usr/bin/python3.6 /usr/bin/python3 && CC=clang-5.0 && CXX=clang++-5.0"
      - CXXFLAGS="-pedantic -Werror -g -fno-omit-frame-pointer -fsanitize=undefined -fno-sanitize-recover=undefined"
      - UBSAN_OPTIONS=print_stacktrace=1

  - name: Ubuntu Linux 14.04, Clang 5.0 (rumur multithreaded XML)
    os: linux
    dist: trusty
    addons:
      apt:
        sources:
          - deadsnakes
          - ubuntu-toolchain-r-test
          - llvm-toolchain-trusty-5.0
        packages:
          - clang-5.0
          - g++-6
          - libxml2-utils
          - python3.6
          - valgrind
    env:
      - TEST_ARGS="rumurOptimisedMultithreadedXML rumurMultithreadedXML"
      - MATRIX_EVAL="sudo ln -sf /usr/bin/python3.6 /usr/bin/python3 && CC=clang-5.0 && CXX=clang++-5.0"
      - CXXFLAGS="-pedantic -Werror -g -fno-omit-frame-pointer -fsanitize=undefined -fno-sanitize-recover=undefined"
      - UBSAN_OPTIONS=print_stacktrace=1

  - name: Ubuntu Linux 14.04, Clang 6.0 (executable, murphi2c, murphi2xml)
    os: linux
    dist: trusty
    addons:
      apt:
        sources:
          - deadsnakes
          - ubuntu-toolchain-r-test
          - llvm-toolchain-trusty-6.0
        packages:
          - clang-6.0
          - g++-6
          - libxml2-utils
          - python3.6
          - valgrind
    env:
      - TEST_ARGS="executable murphi2c murphi2cHeader murphi2xml"
      - MATRIX_EVAL="sudo ln -sf /usr/bin/python3.6 /usr/bin/python3 && CC=clang-6.0 && CXX=clang++-6.0"
      - CXXFLAGS="-pedantic -Werror -g -fno-omit-frame-pointer -fsanitize=undefined -fno-sanitize-recover=undefined"
      - UBSAN_OPTIONS=print_stacktrace=1

  - name: Ubuntu Linux 14.04, Clang 6.0 (rumur single-threaded)
    os: linux
    dist: trusty
    addons:
      apt:
        sources:
          - deadsnakes
          - ubuntu-toolchain-r-test
          - llvm-toolchain-trusty-6.0
        packages:
          - clang-6.0
          - g++-6
          - libxml2-utils
          - python3.6
          - valgrind
    env:
      - TEST_ARGS="rumurDebugSingleThreaded rumurSingleThreaded"
      - MATRIX_EVAL="sudo ln -sf /usr/bin/python3.6 /usr/bin/python3 && CC=clang-6.0 && CXX=clang++-6.0"
      - CXXFLAGS="-pedantic -Werror -g -fno-omit-frame-pointer -fsanitize=undefined -fno-sanitize-recover=undefined"
      - UBSAN_OPTIONS=print_stacktrace=1

  - name: Ubuntu Linux 14.04, Clang 6.0 (rumur optimised single-threaded)
    os: linux
    dist: trusty
    addons:
      apt:
        sources:
          - deadsnakes
          - ubuntu-toolchain-r-test
          - llvm-toolchain-trusty-6.0
        packages:
          - clang-6.0
          - g++-6
          - libxml2-utils
          - python3.6
          - valgrind
    env:
      - TEST_ARGS="rumurDebugOptimisedSingleThreaded rumurOptimisedSingleThreaded"
      - MATRIX_EVAL="sudo ln -sf /usr/bin/python3.6 /usr/bin/python3 && CC=clang-6.0 && CXX=clang++-6.0"
      - CXXFLAGS="-pedantic -Werror -g -fno-omit-frame-pointer -fsanitize=undefined -fno-sanitize-recover=undefined"
      - UBSAN_OPTIONS=print_stacktrace=1

  - name: Ubuntu Linux 14.04, Clang 6.0 (rumur multithreaded)
    os: linux
    dist: trusty
    addons:
      apt:
        sources:
          - deadsnakes
          - ubuntu-toolchain-r-test
          - llvm-toolchain-trusty-6.0
        packages:
          - clang-6.0
          - g++-6
          - libxml2-utils
          - python3.6
          - valgrind
    env:
      - TEST_ARGS="rumurDebugMultithreaded rumurMultithreaded"
      - MATRIX_EVAL="sudo ln -sf /usr/bin/python3.6 /usr/bin/python3 && CC=clang-6.0 && CXX=clang++-6.0"
      - CXXFLAGS="-pedantic -Werror -g -fno-omit-frame-pointer -fsanitize=undefined -fno-sanitize-recover=undefined"
      - UBSAN_OPTIONS=print_stacktrace=1

  - name: Ubuntu Linux 14.04, Clang 6.0 (rumur optimised multithreaded)
    os: linux
    dist: trusty
    addons:
      apt:
        sources:
          - deadsnakes
          - ubuntu-toolchain-r-test
          - llvm-toolchain-trusty-6.0
        packages:
          - clang-6.0
          - g++-6
          - libxml2-utils
          - python3.6
          - valgrind
    env:
      - TEST_ARGS="rumurDebugOptimisedMultithreaded rumurOptimisedMultithreaded"
      - MATRIX_EVAL="sudo ln -sf /usr/bin/python3.6 /usr/bin/python3 && CC=clang-6.0 && CXX=clang++-6.0"
      - CXXFLAGS="-pedantic -Werror -g -fno-omit-frame-pointer -fsanitize=undefined -fno-sanitize-recover=undefined"
      - UBSAN_OPTIONS=print_stacktrace=1

  - name: Ubuntu Linux 14.04, Clang 6.0 (rumur single-threaded XML)
    os: linux
    dist: trusty
    addons:
      apt:
        sources:
          - deadsnakes
          - ubuntu-toolchain-r-test
          - llvm-toolchain-trusty-6.0
        packages:
          - clang-6.0
          - g++-6
          - libxml2-utils
          - python3.6
          - valgrind
    env:
      - TEST_ARGS="rumurOptimisedSingleThreadedXML rumurSingleThreadedXML"
      - MATRIX_EVAL="sudo ln -sf /usr/bin/python3.6 /usr/bin/python3 && CC=clang-6.0 && CXX=clang++-6.0"
      - CXXFLAGS="-pedantic -Werror -g -fno-omit-frame-pointer -fsanitize=undefined -fno-sanitize-recover=undefined"
      - UBSAN_OPTIONS=print_stacktrace=1

  - name: Ubuntu Linux 14.04, Clang 6.0 (rumur multithreaded XML)
    os: linux
    dist: trusty
    addons:
      apt:
        sources:
          - deadsnakes
          - ubuntu-toolchain-r-test
          - llvm-toolchain-trusty-6.0
        packages:
          - clang-6.0
          - g++-6
          - libxml2-utils
          - python3.6
          - valgrind
    env:
      - TEST_ARGS="rumurOptimisedMultithreadedXML rumurMultithreadedXML"
      - MATRIX_EVAL="sudo ln -sf /usr/bin/python3.6 /usr/bin/python3 && CC=clang-6.0 && CXX=clang++-6.0"
      - CXXFLAGS="-pedantic -Werror -g -fno-omit-frame-pointer -fsanitize=undefined -fno-sanitize-recover=undefined"
      - UBSAN_OPTIONS=print_stacktrace=1

  - name: Ubuntu Linux 14.04, Clang 7 (executable, murphi2c, murphi2xml)
    os: linux
    dist: trusty
    addons:
      apt:
        sources:
          - deadsnakes
          - ubuntu-toolchain-r-test
          - llvm-toolchain-trusty-7
        packages:
          - clang-7
          - g++-6
          - libxml2-utils
          - python3.6
          - valgrind
    env:
      - TEST_ARGS="executable murphi2c murphi2cHeader murphi2xml"
      - MATRIX_EVAL="sudo ln -sf /usr/bin/python3.6 /usr/bin/python3 && CC=clang-7 && CXX=clang++-7"
      - CXXFLAGS="-pedantic -Werror -g -fno-omit-frame-pointer -fsanitize=undefined -fno-sanitize-recover=undefined"
      - UBSAN_OPTIONS=print_stacktrace=1

  - name: Ubuntu Linux 14.04, Clang 7 (rumur single-threaded)
    os: linux
    dist: trusty
    addons:
      apt:
        sources:
          - deadsnakes
          - ubuntu-toolchain-r-test
          - llvm-toolchain-trusty-7
        packages:
          - clang-7
          - g++-6
          - libxml2-utils
          - python3.6
          - valgrind
    env:
      - TEST_ARGS="rumurDebugSingleThreaded rumurSingleThreaded"
      - MATRIX_EVAL="sudo ln -sf /usr/bin/python3.6 /usr/bin/python3 && CC=clang-7 && CXX=clang++-7"
      - CXXFLAGS="-pedantic -Werror -g -fno-omit-frame-pointer -fsanitize=undefined -fno-sanitize-recover=undefined"
      - UBSAN_OPTIONS=print_stacktrace=1

  - name: Ubuntu Linux 14.04, Clang 7 (rumur optimised single-threaded)
    os: linux
    dist: trusty
    addons:
      apt:
        sources:
          - deadsnakes
          - ubuntu-toolchain-r-test
          - llvm-toolchain-trusty-7
        packages:
          - clang-7
          - g++-6
          - libxml2-utils
          - python3.6
          - valgrind
    env:
      - TEST_ARGS="rumurDebugOptimisedSingleThreaded rumurOptimisedSingleThreaded"
      - MATRIX_EVAL="sudo ln -sf /usr/bin/python3.6 /usr/bin/python3 && CC=clang-7 && CXX=clang++-7"
      - CXXFLAGS="-pedantic -Werror -g -fno-omit-frame-pointer -fsanitize=undefined -fno-sanitize-recover=undefined"
      - UBSAN_OPTIONS=print_stacktrace=1

  - name: Ubuntu Linux 14.04, Clang 7 (rumur multithreaded)
    os: linux
    dist: trusty
    addons:
      apt:
        sources:
          - deadsnakes
          - ubuntu-toolchain-r-test
          - llvm-toolchain-trusty-7
        packages:
          - clang-7
          - g++-6
          - libxml2-utils
          - python3.6
          - valgrind
    env:
      - TEST_ARGS="rumurDebugMultithreaded rumurMultithreaded"
      - MATRIX_EVAL="sudo ln -sf /usr/bin/python3.6 /usr/bin/python3 && CC=clang-7 && CXX=clang++-7"
      - CXXFLAGS="-pedantic -Werror -g -fno-omit-frame-pointer -fsanitize=undefined -fno-sanitize-recover=undefined"
      - UBSAN_OPTIONS=print_stacktrace=1

  - name: Ubuntu Linux 14.04, Clang 7 (rumur optimised multithreaded)
    os: linux
    dist: trusty
    addons:
      apt:
        sources:
          - deadsnakes
          - ubuntu-toolchain-r-test
          - llvm-toolchain-trusty-7
        packages:
          - clang-7
          - g++-6
          - libxml2-utils
          - python3.6
          - valgrind
    env:
      - TEST_ARGS="rumurDebugOptimisedMultithreaded rumurOptimisedMultithreaded"
      - MATRIX_EVAL="sudo ln -sf /usr/bin/python3.6 /usr/bin/python3 && CC=clang-7 && CXX=clang++-7"
      - CXXFLAGS="-pedantic -Werror -g -fno-omit-frame-pointer -fsanitize=undefined -fno-sanitize-recover=undefined"
      - UBSAN_OPTIONS=print_stacktrace=1

  - name: Ubuntu Linux 14.04, Clang 7 (rumur single-threaded XML)
    os: linux
    dist: trusty
    addons:
      apt:
        sources:
          - deadsnakes
          - ubuntu-toolchain-r-test
          - llvm-toolchain-trusty-7
        packages:
          - clang-7
          - g++-6
          - libxml2-utils
          - python3.6
          - valgrind
    env:
      - TEST_ARGS="rumurOptimisedSingleThreadedXML rumurSingleThreadedXML"
      - MATRIX_EVAL="sudo ln -sf /usr/bin/python3.6 /usr/bin/python3 && CC=clang-7 && CXX=clang++-7"
      - CXXFLAGS="-pedantic -Werror -g -fno-omit-frame-pointer -fsanitize=undefined -fno-sanitize-recover=undefined"
      - UBSAN_OPTIONS=print_stacktrace=1

  - name: Ubuntu Linux 14.04, Clang 7 (rumur multithreaded XML)
    os: linux
    dist: trusty
    addons:
      apt:
        sources:
          - deadsnakes
          - ubuntu-toolchain-r-test
          - llvm-toolchain-trusty-7
        packages:
          - clang-7
          - g++-6
          - libxml2-utils
          - python3.6
          - valgrind
    env:
      - TEST_ARGS="rumurOptimisedMultithreadedXML rumurMultithreadedXML"
      - MATRIX_EVAL="sudo ln -sf /usr/bin/python3.6 /usr/bin/python3 && CC=clang-7 && CXX=clang++-7"
      - CXXFLAGS="-pedantic -Werror -g -fno-omit-frame-pointer -fsanitize=undefined -fno-sanitize-recover=undefined"
      - UBSAN_OPTIONS=print_stacktrace=1

  - name: Ubuntu Linux 14.04, Clang 8 (executable, murphi2c, murphi2xml)
    os: linux
    dist: trusty
    addons:
      apt:
        sources:
          - deadsnakes
          - ubuntu-toolchain-r-test
          - llvm-toolchain-trusty-8
        packages:
          - clang-8
          - g++-6
          - libxml2-utils
          - python3.6
          - valgrind
    env:
      - TEST_ARGS="executable murphi2c murphi2cHeader murphi2xml"
      - MATRIX_EVAL="sudo ln -sf /usr/bin/python3.6 /usr/bin/python3 && CC=clang-8 && CXX=clang++-8"
      - CXXFLAGS="-pedantic -Werror -g -fno-omit-frame-pointer -fsanitize=undefined -fno-sanitize-recover=undefined"
      - UBSAN_OPTIONS=print_stacktrace=1

  - name: Ubuntu Linux 14.04, Clang 8 (rumur single-threaded)
    os: linux
    dist: trusty
    addons:
      apt:
        sources:
          - deadsnakes
          - ubuntu-toolchain-r-test
          - llvm-toolchain-trusty-8
        packages:
          - clang-8
          - g++-6
          - libxml2-utils
          - python3.6
          - valgrind
    env:
      - TEST_ARGS="rumurDebugSingleThreaded rumurSingleThreaded"
      - MATRIX_EVAL="sudo ln -sf /usr/bin/python3.6 /usr/bin/python3 && CC=clang-8 && CXX=clang++-8"
      - CXXFLAGS="-pedantic -Werror -g -fno-omit-frame-pointer -fsanitize=undefined -fno-sanitize-recover=undefined"
      - UBSAN_OPTIONS=print_stacktrace=1

  - name: Ubuntu Linux 14.04, Clang 8 (rumur optimised single-threaded)
    os: linux
    dist: trusty
    addons:
      apt:
        sources:
          - deadsnakes
          - ubuntu-toolchain-r-test
          - llvm-toolchain-trusty-8
        packages:
          - clang-8
          - g++-6
          - libxml2-utils
          - python3.6
          - valgrind
    env:
      - TEST_ARGS="rumurDebugOptimisedSingleThreaded rumurOptimisedSingleThreaded"
      - MATRIX_EVAL="sudo ln -sf /usr/bin/python3.6 /usr/bin/python3 && CC=clang-8 && CXX=clang++-8"
      - CXXFLAGS="-pedantic -Werror -g -fno-omit-frame-pointer -fsanitize=undefined -fno-sanitize-recover=undefined"
      - UBSAN_OPTIONS=print_stacktrace=1

  - name: Ubuntu Linux 14.04, Clang 8 (rumur multithreaded)
    os: linux
    dist: trusty
    addons:
      apt:
        sources:
          - deadsnakes
          - ubuntu-toolchain-r-test
          - llvm-toolchain-trusty-8
        packages:
          - clang-8
          - g++-6
          - libxml2-utils
          - python3.6
          - valgrind
    env:
      - TEST_ARGS="rumurDebugMultithreaded rumurMultithreaded"
      - MATRIX_EVAL="sudo ln -sf /usr/bin/python3.6 /usr/bin/python3 && CC=clang-8 && CXX=clang++-8"
      - CXXFLAGS="-pedantic -Werror -g -fno-omit-frame-pointer -fsanitize=undefined -fno-sanitize-recover=undefined"
      - UBSAN_OPTIONS=print_stacktrace=1

  - name: Ubuntu Linux 14.04, Clang 8 (rumur optimised multithreaded)
    os: linux
    dist: trusty
    addons:
      apt:
        sources:
          - deadsnakes
          - ubuntu-toolchain-r-test
          - llvm-toolchain-trusty-8
        packages:
          - clang-8
          - g++-6
          - libxml2-utils
          - python3.6
          - valgrind
    env:
      - TEST_ARGS="rumurDebugOptimisedMultithreaded rumurOptimisedMultithreaded"
      - MATRIX_EVAL="sudo ln -sf /usr/bin/python3.6 /usr/bin/python3 && CC=clang-8 && CXX=clang++-8"
      - CXXFLAGS="-pedantic -Werror -g -fno-omit-frame-pointer -fsanitize=undefined -fno-sanitize-recover=undefined"
      - UBSAN_OPTIONS=print_stacktrace=1

  - name: Ubuntu Linux 14.04, Clang 8 (rumur single-threaded XML)
    os: linux
    dist: trusty
    addons:
      apt:
        sources:
          - deadsnakes
          - ubuntu-toolchain-r-test
          - llvm-toolchain-trusty-8
        packages:
          - clang-8
          - g++-6
          - libxml2-utils
          - python3.6
          - valgrind
    env:
      - TEST_ARGS="rumurOptimisedSingleThreadedXML rumurSingleThreadedXML"
      - MATRIX_EVAL="sudo ln -sf /usr/bin/python3.6 /usr/bin/python3 && CC=clang-8 && CXX=clang++-8"
      - CXXFLAGS="-pedantic -Werror -g -fno-omit-frame-pointer -fsanitize=undefined -fno-sanitize-recover=undefined"
      - UBSAN_OPTIONS=print_stacktrace=1

  - name: Ubuntu Linux 14.04, Clang 8 (rumur multithreaded XML)
    os: linux
    dist: trusty
    addons:
      apt:
        sources:
          - deadsnakes
          - ubuntu-toolchain-r-test
          - llvm-toolchain-trusty-8
        packages:
          - clang-8
          - g++-6
          - libxml2-utils
          - python3.6
          - valgrind
    env:
      - TEST_ARGS="rumurOptimisedMultithreadedXML rumurMultithreadedXML"
      - MATRIX_EVAL="sudo ln -sf /usr/bin/python3.6 /usr/bin/python3 && CC=clang-8 && CXX=clang++-8"
      - CXXFLAGS="-pedantic -Werror -g -fno-omit-frame-pointer -fsanitize=undefined -fno-sanitize-recover=undefined"
      - UBSAN_OPTIONS=print_stacktrace=1

  - name: Ubuntu Linux 20.04, Clang 8 (executable, murphi2c, murphi2xml)
    os: linux
    dist: focal
    addons:
      apt:
        packages:
          - clang-8
          - libfl-dev
          - libxml2-utils
          - valgrind
          - z3
    env:
      - TEST_ARGS="executable murphi2c murphi2cHeader murphi2xml"
      - MATRIX_EVAL="CC=clang-8 && CXX=clang++-8"
      - CXXFLAGS="-pedantic -Werror -g -fno-omit-frame-pointer -fsanitize=undefined -fno-sanitize-recover=undefined"
      - UBSAN_OPTIONS=print_stacktrace=1

  - name: Ubuntu Linux 20.04, Clang 8 (rumur single-threaded)
    os: linux
    dist: focal
    addons:
      apt:
        packages:
          - clang-8
          - libfl-dev
          - libxml2-utils
          - valgrind
          - z3
    env:
      - TEST_ARGS="rumurDebugSingleThreaded rumurSingleThreaded"
      - MATRIX_EVAL="CC=clang-8 && CXX=clang++-8"
      - CXXFLAGS="-pedantic -Werror -g -fno-omit-frame-pointer -fsanitize=undefined -fno-sanitize-recover=undefined"
      - UBSAN_OPTIONS=print_stacktrace=1

  - name: Ubuntu Linux 20.04, Clang 8 (rumur optimised single-threaded)
    os: linux
    dist: focal
    addons:
      apt:
        packages:
          - clang-8
          - libfl-dev
          - libxml2-utils
          - valgrind
          - z3
    env:
      - TEST_ARGS="rumurDebugOptimisedSingleThreaded rumurOptimisedSingleThreaded"
      - MATRIX_EVAL="CC=clang-8 && CXX=clang++-8"
      - CXXFLAGS="-pedantic -Werror -g -fno-omit-frame-pointer -fsanitize=undefined -fno-sanitize-recover=undefined"
      - UBSAN_OPTIONS=print_stacktrace=1

  - name: Ubuntu Linux 20.04, Clang 8 (rumur multithreaded)
    os: linux
    dist: focal
    addons:
      apt:
        packages:
          - clang-8
          - libfl-dev
          - libxml2-utils
          - valgrind
          - z3
    env:
      - TEST_ARGS="rumurDebugMultithreaded rumurMultithreaded"
      - MATRIX_EVAL="CC=clang-8 && CXX=clang++-8"
      - CXXFLAGS="-pedantic -Werror -g -fno-omit-frame-pointer -fsanitize=undefined -fno-sanitize-recover=undefined"
      - UBSAN_OPTIONS=print_stacktrace=1

  - name: Ubuntu Linux 20.04, Clang 8 (rumur optimised multithreaded)
    os: linux
    dist: focal
    addons:
      apt:
        packages:
          - clang-8
          - libfl-dev
          - libxml2-utils
          - valgrind
          - z3
    env:
      - TEST_ARGS="rumurDebugOptimisedMultithreaded rumurOptimisedMultithreaded"
      - MATRIX_EVAL="CC=clang-8 && CXX=clang++-8"
      - CXXFLAGS="-pedantic -Werror -g -fno-omit-frame-pointer -fsanitize=undefined -fno-sanitize-recover=undefined"
      - UBSAN_OPTIONS=print_stacktrace=1

  - name: Ubuntu Linux 20.04, Clang 8 (rumur single-threaded XML)
    os: linux
    dist: focal
    addons:
      apt:
        packages:
          - clang-8
          - libfl-dev
          - libxml2-utils
          - valgrind
          - z3
    env:
      - TEST_ARGS="rumurOptimisedSingleThreadedXML rumurSingleThreadedXML"
      - MATRIX_EVAL="CC=clang-8 && CXX=clang++-8"
      - CXXFLAGS="-pedantic -Werror -g -fno-omit-frame-pointer -fsanitize=undefined -fno-sanitize-recover=undefined"
      - UBSAN_OPTIONS=print_stacktrace=1

  - name: Ubuntu Linux 20.04, Clang 8 (rumur multithreaded XML)
    os: linux
    dist: focal
    addons:
      apt:
        packages:
          - clang-8
          - libfl-dev
          - libxml2-utils
          - valgrind
          - z3
    env:
      - TEST_ARGS="rumurOptimisedMultithreadedXML rumurMultithreadedXML"
      - MATRIX_EVAL="CC=clang-8 && CXX=clang++-8"
      - CXXFLAGS="-pedantic -Werror -g -fno-omit-frame-pointer -fsanitize=undefined -fno-sanitize-recover=undefined"
      - UBSAN_OPTIONS=print_stacktrace=1

  - name: Ubuntu Linux 20.04, GCC 10, AFL
    os: linux
    dist: focal
    addons:
      apt:
        packages:
          - g++-10
          - libfl-dev
    env:
      # install AFL and let it catch crashes via core dumps
      - MATRIX_EVAL="echo core | sudo tee /proc/sys/kernel/core_pattern && ./misc/install-afl.sh && CC=gcc-10 && CXX=afl-g++"

      # quit if we succeed exhaustively fuzzing (unlikely)
      - AFL_EXIT_WHEN_DONE=1

      # suppress normal animated UI and use periodic text output
      - AFL_NO_UI=1

      # enable ASan and UBSan
      - CXXFLAGS="-g -fsanitize=address,undefined -fno-sanitize-recover=undefined -O3"

      - CUSTOM_COMMAND="travis_wait 60 ../misc/afl-wrapper.sh"

before_install:
  - eval "${MATRIX_EVAL}"

script:
  - uname -sr && python3 --version && printf "_NPROCESSORS_ONLN " && getconf _NPROCESSORS_ONLN && mkdir build && cd build && cmake .. && cmake --build . -- -j2 && sudo env "PATH=$PATH" cmake --build . -- install && if [ -z "${CUSTOM_COMMAND}" ]; then env PATH=./rumur:./murphi2c:./murphi2murphi:./murphi2xml:./tests/murphi-comment-ls:${PATH} ../tests/run-tests.py --verbose ${TEST_ARGS}; else eval "${CUSTOM_COMMAND}"; fi
